function escapeRegExp(t){return t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}function indexer(t){var e={};this.obj=t.obj,this.fields=[],this.exclude=t.exclude||[],this.valueParsers={},this.MAX_LEVELS=void 0!==t.maxLevels?t.maxLevels:Number.MAX_SAFE_INTEGER,this.scores=t.scores||null,this.isExcluded=function(t){return this.exclude.indexOf(t)>-1},this.parseFields=function(t){for(var e=0;e<t.length;e++){var r=t[e];if("object"==typeof r)for(var s in r)this.valueParsers[s]=r[s],this.fields.push(s);else this.fields.push(r)}},this.getParsedValue=function(t,e){var r=this.valueParsers[t];if(r&&"function"==typeof r){var s=r(e);return s}return e},this.createIndex=function(t,r){_.each(t,function(t,r){_.each(t,function(r,s){if(!this.isExcluded(s)&&this.keyInFields(s)){var i=this.getParsedValue(s,r),n=this.tokenize(i);_.each(n,function(r){r=r.trim(),r&&r.length>1&&STOP_WORDS.indexOf(r)<0&&(e[r]||(e[r]={}),e[r][t.id]||(e[r][t.id]=0),this.scores&&this.scores[s]?e[r][t.id]+=this.scores[s]:e[r][t.id]++)},this)}},this)},this)},this.keyInFields=function(t){return this.fields.indexOf(t)>-1},this.tokenize=function(t){return t=t.replace(/[^a-zA-Z0-9'-]+/gi," "),t.toLowerCase().split(" ")},this.getQueryRegex=function(t){return new RegExp("^"+t,"i")},this.search=function(t){var r=t.split(/\s/g),s=[],i={},n=e;return _.each(r,function(t,e){if(t=t.trim(),t.length){var r={};_.each(n,function(s,n){var a=this.getQueryRegex(t),o=n.search(a)>-1;return o&&_.each(s,function(t,s){e>0&&!i[s]||(r[s]||(r[s]=0),r[s]+=t)},this),o},this);var s={};_.each(r,function(t,n){return e>0&&!i[n]?!1:(s[n]=r[n]+(i[n]||0),!0)}),i=s}},this),s=Object.keys(i).sort(function(t,e){return i[e]-i[t]})},this.parseFields(t.fields),this.createIndex(this.obj,null,this.MAX_LEVELS)}var STOP_WORDS=["and","a","are","the","then","this","as","if","an","at","to","-","be","for","can","when","where","what","but","by"];Array.prototype.getUnique=function(){for(var t={},e=[],r=0,s=this.length;s>r;++r)t.hasOwnProperty(this[r])||(e.push(this[r]),t[this[r]]=1);return e};var settings=function(){var t=null,e=null,r=function(){var t={active:!0,explicitVersions:[]};return t},s=function(){var t=["ie","edge","firefox","chrome","safari","opera","ios_saf","android","and_chr"],e={browsers:{global:r(),browsers:{}},local:!1};return _.each(t,function(t){e.browsers.browsers[t]=r()}),e};t=s();var i=$.Deferred(),n={usable:!1,isOnline:navigator.onLine,_defaults:t,setCanUse:function(){n.usable=!0,i.resolve()},setCanNotUse:function(){n.usable=!1},whenUsable:function(){return i},get:function(r){var s=$.Deferred();return e?(r&&r(e),s.resolve(e)):(chrome.storage.local.get("settings",function(i){e=i&&i.settings?$.extend({},t,i.settings):t,r&&r(e),s.resolve(e)}),s)},save:function(){var t=$.extend({},e),r=$.Deferred();return chrome.storage.local.set({settings:t},function(){r.resolve(!0)}),r},getBrowserSettings:function(t){return e.browsers.browsers[t]},browserIsActive:function(t){var e=n.getBrowserSettings(t);return e&&e.active},versionIsExplicit:function(t,e){var r=n.getBrowserSettings(t);return r?r.explicitVersions.indexOf(e)>-1:!1},toggleBrowserState:function(t){var s=n.getBrowserSettings(t);return s?(s.active?s.active=!1:s.active=!0,void n.save()):void(e.browsers.browsers[t]=r())},toggleVersionState:function(t,e){var r=n.getBrowserSettings(t);if(r){var s=r.explicitVersions.indexOf(e);s>-1?r.explicitVersions.splice(s,1):r.explicitVersions.push(e),n.save()}},toggleLocal:function(){e.local?(e.local=!1,n.removeDataLocally()):(e.local=!0,n.saveDataLocally()),n.save()},shouldSaveData:function(){return e.local},saveDataLocally:function(){var t=$.Deferred();if(!navigator.onLine)return t.reject("offline");var r=Date.now();return e.lastUpdated=r,chrome.storage.local.set({caniuse:caniuse.full,updated:r},function(){t.resolve(r)}),t},removeDataLocally:function(){chrome.storage.local.remove("caniuse",function(){e.lastUpdated=!1})},lastUpdated:function(){return e.lastUpdated},getData:function(){var t=$.Deferred();return chrome.storage.local.get("caniuse",function(e){e&&e.caniuse&&t.resolve(e.caniuse)}),t}};return n}(),CaniuseBrowser=function(t,e){var r=["id","browser","type","version_list","current_version"];this.data=null,this.caniuse=null,this.getVersions=function(t){return t?this.full.version_list:this.data.version_list},this.getActiveVersions=function(){var t=this.getVersions(!0);return _.filter(t,function(t){return this.versionIsGreen(t)||settings.versionIsExplicit(this.data.id,t.version)},this)},this.isCurrentVersion=function(t){return this.data.current_version===t},this.isFuture=function(t){var t=this.getVersion(t);return t.era>0},this.getVersion=function(t){return _.find(this.full.version_list,function(e){return e.version==t})},this.versionIsGreen=function(t){return"object"!=typeof t&&(t=this.getVersion(t)),t.era>=-2&&t.era<=2},this.getFullUsage=function(){var t=_.reduce(this.full.version_list,function(t,e){return t+e.global_usage},0);return parseFloat(t.toFixed(2))},this.getUsage=function(t){var t=this.getVersion(t);return t&&t.global_usage},this.getEra=function(t){var t=getVersion(t);return t&&t.era},this.getSupport=function(t,e){var r=this.caniuse.getFeature(t);r.getBrowserStat(this.data.id)},this.getVersionsBeforeCurrent=function(){var t=this.getVersions(!0),e=[];return _.find(t,function(t){return t.era<0?(e.push(t),!1):!0}),e},this.getVersionsAfterCurrent=function(){var t=this.getVersions(!0),e=[];return _.each(t,function(t){return t.era>0?(e.push(t),!1):!0}),e},this.getVersionUsage=function(t){var t=this.getVersion(t);return t.global_usage},this.init=function(t,e){return this.full=t,this.caniuse=e,this.data=_.pick(t,r),this.data},this.init(t,e)},CaniuseFeature=function(t,e){var r=this,s=["id","description","notes_by_num","spec","stats","title"];this.data=null,this.caniuse=null,this.isMatch=function(t){return this.data.description.search(t)>-1||this.data.title.search(t)>-1},this.getBrowserStat=function(t,e){var r=this.data.stats[t];return e?r[e]:r},this.getSupportedBrowsers=function(){return _.mapObject(this.full.stats,function(t){return _.pick(t,function(t){var e=t[0];return"y"===e||"a"===e})})},this.getNotes=function(){return this.data.notes_by_num},this.getGlobalStats=function(){var t=this.getSupportedBrowsers(),e={full:0,partial:0,total:0};_.each(t,function(t,s){_.each(t,function(t,i){var n=r.caniuse.getUsage(s,i);e.total+=n,t.indexOf("y")>-1&&(e.full+=n),t.indexOf("a")>-1&&(e.partial+=n)})});for(var s in e)e[s]=parseFloat(e[s].toFixed(2));return e},this.parseSupport=function(t,e){for(var r=t.split(" "),s=(r.unshift(),{version:e}),i=0;i<r.length;i++){var n=r[i];switch(n){case"y":s.supported=!0;break;case"n":s.supported=!1;break;case"a":s.supported=!0,s.partial=!0;break;case"x":s.prefix=!0;break;default:if("#"===n[0]){s.notes=s.notes||[],s.notes.push(n.match(/\d+/)[0]);break}s.supported=!1,s.unknown=!0}}return s},this.init=function(t,e){return this.caniuse=e,this.full=t,this.data=_.pick(t,s),this.data.stats=_.mapObject(this.data.stats,function(t,e){r.caniuse.getBrowser(e);return t=_.mapObject(t,r.parseSupport)}),this.index={id:this.data.id,title:this.data.title,description:this.data.description},t},this.init(t,e)},CaniuseData=function(t){var e=this,r={};this.data=null,this.browsers=null,this.features=null,this.notableBrowsers=["ie","edge","firefox","chrome","safari","opera","ios_saf","android","and_chr"],this.getFeature=function(t){return this.features[t]},this.getBrowsers=function(){return this.browsers},this.getBrowser=function(t){return this.browsers&&this.browsers[t]},this.getBrowserVersion=function(t,e){var r=this.getBrowser(t);return r?r.getVersion(e):!1},this.isNotableBrowser=function(t){return settings.browserIsActive(t)},this.getNotableBrowsers=function(){return _.pick(this.browsers,function(t,r){return e.isNotableBrowser(r)})},this.isCurrentVersion=function(t,e){var r=this.getBrowser(t);return r.isCurrentVersion(e)},this.isFuture=function(t,e){var r=this.getBrowser(t);return r.isFuture(e)},this.getUsage=function(t,e){var r=this.getBrowser(t);return r.getUsage(e)},this.parseFeatureData=function(t){return this.features=_.mapObject(t,function(t,r){return t.id=r,new CaniuseFeature(t,e)}),this.features},this.parseBrowserData=function(t){return this.browsers=_.mapObject(t,function(t,r){return t.id=r,new CaniuseBrowser(t,e)}),this.browsers},this.findFeature=function(t,s){s=void 0!==s?s:Number.MAX_SAFE_INTEGER;var i=[],n=[];return n=r[t]&&r[t].length>=s?r[t]:this.index.search(t),_.every(n,function(t){var r=e.features[t];return i.push(r),!(--s<=0)}),r[t]=n,{results:i,total:n.length,query:t}},this.getSearchableObject=function(){return _.map(this.features,function(t){return _.pick(t,"index").index})},this.createIndex=function(){var t=this.getSearchableObject();this.index=new indexer({obj:t,fields:["title","description","id"],scores:{title:2}})},this.parse=function(t){this.full=t,this.parseBrowserData(t.agents),this.parseFeatureData(t.data),this.createIndex()},this.parse(t)},caniuse=null,retrieveDataFromSource=function(){var t=$.Deferred(),e="https://raw.githubusercontent.com/Fyrd/caniuse/master/fulldata-json/data-2.0.json";return $.getJSON(e).done(function(e){t.resolve(e)}).fail(function(){t.reject()}),t},retrieveData=function(){var t=$.Deferred();return navigator.onLine?retrieveDataFromSource().done(function(e){t.resolve(e)}).fail(function(){settings.shouldSaveData()?settings.getData().done(t.resolve):t.reject(!1)}):settings.shouldSaveData()?settings.getData().done(t.resolve):t.reject("offline and no storage found"),t};settings.get().done(function(){retrieveData().done(function(t){settings.setCanUse(),caniuse=new CaniuseData(t),settings.shouldSaveData()&&settings.saveDataLocally()}).fail(function(){settings.setCanNotUse()})});