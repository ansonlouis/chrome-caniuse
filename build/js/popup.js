var app=angular.module("CaniuseApp",[]),background=chrome.extension.getBackgroundPage();app.value("caniuse",background.caniuse),app.value("settings",background.settings),app.filter("orderByEra",function(){return function(e,t){var r=[],n=background.caniuse.getBrowser(t),u=n.getActiveVersions();return _.each(u,function(t){var n=e[t.version];r.push(n)}),r}}),app.filter("reverse",function(){return function(e){return e.slice().reverse()}}),app.controller("caniuseController",["$scope","$http","caniuse","settings",function(e,t,r,n){e.result=null,e.results=null,e.caniuse=r,e.settings=null,e.searchValue="",e.resultActive=0,e.hoveredStat=null,e.hoveredUsage=null,n.get(function(t){e.settings=n,e.$applyAsync()}),e.$on("feature-search-results",function(t,r){e.searchValue=r.query,e.result=null,e.resultActive=0,r&&r.results.length&&(e.result=r.results[0]),e.$applyAsync()}),e.$on("feature-chosen",function(t,r){e.result=r,e.resultActive=0,e.searchValue="",e.$applyAsync()}),e.highlight=function(t,n){var u=e.result.getBrowserStat(t,n);e.hoveredStat=u,e.hoveredUsage=r.getBrowser(t).getUsage(n)},e.unhighlight=function(){e.hoveredStat=null,e.hoveredUsage=null},e.hoveredNote=function(t){return e.hoveredStat&&e.hoveredStat.notes?_.find(e.hoveredStat.notes,function(e){return t==e}):void 0},e.getStatus=function(t){return e.result?e.result.getBrowserStat(t):null},e.currentOffset=function(t){var n=[];if(e.result){var u=e.result.data.stats,a=0,s=0;_.map(u,function(e,n){var u=0,o=r.getBrowser(n);_.each(o.getActiveVersions(),function(e){e.era<0&&u++}),u>a&&(a=u),n===t&&(s=u)})}return n=new Array(a-s)},e.noResults=function(){return e.searchValue&&!e.result}}]),app.directive("featureSupport",function(){return{restrict:"E",templateUrl:"templates/feature-support.html",controller:"featureController",scope:{feature:"=featureObj"}}}),app.controller("featureController",["$scope","caniuse","settings",function(e,t,r){e.state=null,e.hoveredStat=null,e.hoveredUsage=null,e.isNumber=angular.isNumber,e.caniuse=t,e.settings=null,e.recompileData=function(){e.stats=e.feature.getGlobalStats()},r.get(function(t){e.settings=r,e.$applyAsync()}),e.recompileData(),e.$watch("feature",function(t,r){e.recompileData()}),e.highlight=function(r,n){var u=e.feature.getBrowserStat(r,n);e.hoveredStat=u,e.hoveredUsage=t.getBrowser(r).getUsage(n)},e.unhighlight=function(){e.hoveredStat=null,e.hoveredUsage=null},e.hoveredNote=function(t){return e.hoveredStat&&e.hoveredStat.notes?_.find(e.hoveredStat.notes,function(e){return t==e}):void 0},e.getStatus=function(t){return e.feature?e.feature.getBrowserStat(t):null},e.currentOffset=function(r){var n=[];if(e.feature){var u=e.feature.data.stats,a=0,s=0;_.map(u,function(e,n){var u=0,o=t.getBrowser(n);_.each(o.getActiveVersions(),function(e){e.era<0&&u++}),u>a&&(a=u),n===r&&(s=u)})}return n=new Array(a-s)}}]),app.directive("featureSearch",function(){return{restrict:"A",link:function(e,t,r){var n=null;t.keyup(_.throttle(function(){var r=t.val().trim();r!==n&&(n=r,e.$emit("feature-search",r))},250))}}}),app.directive("searchEmitter",["caniuse",function(e){return{restrict:"A",link:function(t,r,n){t.$on("feature-search",function(r,n){var u=e.findFeature(n,5);t.$broadcast("feature-search-results",u,n)}),t.$on("choose-feature",function(e,r){t.$broadcast("feature-chosen",r)})}}}]),app.directive("autoComplete",function(){return{restrict:"E",templateUrl:"templates/autocomplete.html",controller:"autocompleteController"}}),app.controller("autocompleteController",["$scope","$http","caniuse","settings",function(e,t,r,n){e.results=null,e.resultActive=0,e.$on("feature-search-results",function(t,r,n){e.results=r&&r.results,e.resultActive=0}),e.navigate=function(t){e.results&&(40===t.which?(t.stopPropagation(),t.preventDefault(),e.resultActive++,e.resultActive>=e.results.length&&(e.resultActive=0)):38===t.which&&(t.stopPropagation(),t.preventDefault(),e.resultActive--,e.resultActive<0&&(e.resultActive=e.results.length-1)),e.chooseResult(e.resultActive))},e.activate=function(t){13===t.which&&(t.stopPropagation(),t.preventDefault(),e.chooseResult(e.resultActive,!0))},e.chooseResult=function(t,r){var n=e.results[t];n&&(e.$emit("choose-feature",n),r&&e.hideResults())},e.hideResults=function(){e.resultActive=0,e.results=null}}]),String.prototype.richText=function(){var e=this.toString();return e=e.replace(/</g,"&lt;").replace(/>/g,"&gt;"),e.replace(/(`(.+?)`)+/gi,function(e,t,r){return"<code>"+r+"</code>"})},app.directive("richText",function(){return{restrict:"A",scope:{value:"@"},link:function(e,t,r){t.html(r.richText.richText()),r.$observe("richText",function(e){t.html(e.richText())})}}}),app.directive("tabLink",function(){return{restrict:"A",scope:{},link:function(e,t,r){t.click(function(e){e.preventDefault(),chrome.tabs.create({url:this.href})})}}});